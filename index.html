<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>United Projects Map</title>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAfX45EKkc_I2jIGHH67iv4H-jOkbgIfNA"></script>
  </head>
  <body>
    <div id="map"></div>
    <script>
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10,
        center: { lat: 51.0447, lng: -114.0719 },
      });

      const infoWindow = new google.maps.InfoWindow();

      map.data.loadGeoJson("https://raw.githubusercontent.com/divikor/unmap/main/united-projects.geojson");

      map.data.setStyle((feature) => {
        const status = feature.getProperty("Status");
        let color = "blue";
        if (status === "Won") color = "green";
        else if (status === "Lose") color = "red";
        else if (status === "Estimating") color = "orange";
        else if (status === "DP placed") color = "purple";
        else if (status === "Bid submitted") color = "gray";

        return {
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 6,
            fillColor: color,
            fillOpacity: 0.9,
            strokeColor: "white",
            strokeWeight: 1,
          },
        };
      });

      map.data.addListener("click", (event) => {
        const props = event.feature.getProperties();
        const content = `
          <div style="min-width:200px">
            <h3>${props["Project Name"]}</h3>
            <p><b>ID:</b> ${props["Project ID"]}</p>
            <p><b>Status:</b> ${props["Status"]}</p>
            <p><b>Description:</b> ${props["Description"]}</p>
            <p><b>Updated:</b> ${props["Updated At"] || "n/a"}</p>
          </div>
        `;
        infoWindow.setContent(content);
        infoWindow.setPosition(event.latLng);
        infoWindow.open(map);
      });
    </script>
  </body>
</html>
